<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é“¶è¡Œç³»ç»Ÿ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #1a3a8f 0%, #2a5bd7 100%);
            color: white;
            padding: 25px 0;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
        }

        .logo i {
            margin-right: 10px;
            font-size: 28px;
        }

        .user-info {
            display: flex;
            align-items: center;
        }

        .user-info span {
            margin-right: 15px;
        }

        nav {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
            overflow: hidden;
        }

        .nav-list {
            display: flex;
            list-style: none;
            justify-content: space-around;
        }

        .nav-list li {
            flex: 1;
            text-align: center;
        }

        .nav-list a {
            display: block;
            padding: 20px 15px;
            text-decoration: none;
            color: #555;
            font-weight: 500;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .nav-list a:hover, .nav-list a.active {
            color: #2a5bd7;
            background-color: #f8f9ff;
            border-bottom-color: #2a5bd7;
        }

        .nav-list i {
            margin-right: 8px;
        }

        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background-color: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.07);
            margin-bottom: 25px;
        }

        .card h2 {
            color: #1a3a8f;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
        }

        .card h2 i {
            margin-right: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #444;
        }

        .form-control {
            width: 100%;
            padding: 14px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: #2a5bd7;
            box-shadow: 0 0 0 3px rgba(42, 91, 215, 0.1);
        }

        .btn {
            display: inline-block;
            padding: 14px 28px;
            background-color: #2a5bd7;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            text-align: center;
        }

        .btn:hover {
            background-color: #1a3a8f;
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-block {
            width: 100%;
            display: block;
        }

        .btn-secondary {
            background-color: #6c757d;
        }

        .btn-secondary:hover {
            background-color: #545b62;
        }

        .btn-success {
            background-color: #28a745;
        }

        .btn-success:hover {
            background-color: #1e7e34;
        }

        .btn-danger {
            background-color: #dc3545;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .btn-group .btn {
            flex: 1;
        }

        .select-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .select-option {
            border: 2px solid #eee;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .select-option:hover {
            border-color: #2a5bd7;
            background-color: #f8f9ff;
        }

        .select-option.selected {
            border-color: #2a5bd7;
            background-color: #eef2ff;
        }

        .select-option i {
            font-size: 32px;
            color: #2a5bd7;
            margin-bottom: 10px;
        }

        .result-box {
            background-color: #f8f9ff;
            border-left: 4px solid #2a5bd7;
            padding: 20px;
            margin-top: 25px;
            border-radius: 0 8px 8px 0;
        }

        .result-box h4 {
            color: #1a3a8f;
            margin-bottom: 10px;
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background-color: #f8f9ff;
            color: #1a3a8f;
            font-weight: 600;
        }

        tr:hover {
            background-color: #f8f9ff;
        }

        .hidden {
            display: none;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .alert-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }

        .verification-step {
            display: none;
        }

        .verification-step.active {
            display: block;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #777;
            font-size: 14px;
            border-top: 1px solid #eee;
        }

        @media (max-width: 768px) {
            .nav-list {
                flex-direction: column;
            }

            .header-content {
                flex-direction: column;
                text-align: center;
            }

            .user-info {
                margin-top: 15px;
            }

            .btn-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-university"></i>
                <span>æ•°å­—é“¶è¡Œç³»ç»Ÿ</span>
            </div>
        </div>
    </header>

    <nav>
        <ul class="nav-list">
            <li><a href="#" class="nav-link active" data-page="register"><i class="fas fa-user-plus"></i>æ³¨å†Œè´¦æˆ·</a></li>
            <li><a href="#" class="nav-link" data-page="transaction"><i class="fas fa-exchange-alt"></i>ä¸šåŠ¡å¤„ç†</a></li>
            <li><a href="#" class="nav-link" data-page="risk"><i class="fas fa-shield-alt"></i>é£æ§å¤„ç†</a></li>
            <li><a href="#" class="nav-link" data-page="personal"><i class="fas fa-user-circle"></i>ä¸ªäººä¸­å¿ƒ</a></li>
        </ul>
    </nav>

    <!-- æ³¨å†Œè´¦æˆ·é¡µé¢ -->
    <div id="register" class="page active">
        <div class="card">
            <h2><i class="fas fa-user-plus"></i>æ³¨å†Œè´¦æˆ·</h2>
            <div class="form-group">
                <label for="phone">æ‰‹æœºå·ç </label>
                <input type="tel" id="phone" class="form-control" placeholder="è¯·è¾“å…¥11ä½æ‰‹æœºå·ç ">
            </div>

            <div class="form-group">
                <label>è´¦æˆ·ç±»å‹</label>
                <div class="select-group">
                    <div class="select-option" data-value="personal">
                        <i class="fas fa-user"></i>
                        <div>ä¸ªäººè´¦æˆ·</div>
                    </div>
                    <div class="select-option" data-value="business">
                        <i class="fas fa-building"></i>
                        <div>ä¼ä¸šè´¦æˆ·</div>
                    </div>
                </div>
                <input type="hidden" id="accountType" value="">
            </div>

            <div class="form-group">
                <label>åˆ†è¡Œç±»å‹</label>
                <div class="select-group">
                    <div class="select-option" data-value="beijing">
                        <i class="fas fa-map-marker-alt"></i>
                        <div>åŒ—äº¬åˆ†è¡Œ</div>
                    </div>
                    <div class="select-option" data-value="shanghai">
                        <i class="fas fa-map-marker-alt"></i>
                        <div>ä¸Šæµ·åˆ†è¡Œ</div>
                    </div>
                    <div class="select-option" data-value="guangzhou">
                        <i class="fas fa-map-marker-alt"></i>
                        <div>å¹¿å·åˆ†è¡Œ</div>
                    </div>
                    <div class="select-option" data-value="shenzhen">
                        <i class="fas fa-map-marker-alt"></i>
                        <div>æ·±åœ³åˆ†è¡Œ</div>
                    </div>
                </div>
                <input type="hidden" id="branchType" value="">
            </div>

            <div class="form-group">
                <label for="password">è´¦æˆ·å¯†ç </label>
                <input type="password" id="password" class="form-control" placeholder="è¯·è¾“å…¥6-20ä½å¯†ç ">
            </div>

            <div class="form-group">
                <label for="confirmPassword">ç¡®è®¤å¯†ç </label>
                <input type="password" id="confirmPassword" class="form-control" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç ">
            </div>

            <button id="registerBtn" class="btn btn-block">æ³¨å†Œè´¦æˆ·</button>

            <div class="result-box hidden" id="registerResult">
                <h4>æ³¨å†Œç»“æœ</h4>
                <div id="registerResultContent"></div>
            </div>
        </div>

        <div class="card">
            <h2><i class="fas fa-search"></i>æŸ¥è¯¢è´¦æˆ·</h2>
            <div class="form-group">
                <label for="searchPhone">æ‰‹æœºå·ç </label>
                <input type="tel" id="searchPhone" class="form-control" placeholder="è¯·è¾“å…¥è¦æŸ¥è¯¢çš„æ‰‹æœºå·ç ">
            </div>

            <button id="searchAccountBtn" class="btn btn-block btn-secondary">æŸ¥è¯¢è´¦æˆ·</button>

            <div class="result-box hidden" id="searchResult">
                <h4>æŸ¥è¯¢ç»“æœ</h4>
                <div id="searchResultContent"></div>
            </div>
        </div>
    </div>

    <!-- ä¸šåŠ¡å¤„ç†é¡µé¢ -->
    <div id="transaction" class="page">
        <div class="card">
            <h2><i class="fas fa-exchange-alt"></i>ä¸šåŠ¡å¤„ç†</h2>

            <div class="btn-group">
                <button id="depositBtn" class="btn"><i class="fas fa-money-bill-wave"></i> å­˜æ¬¾</button>
                <button id="withdrawBtn" class="btn"><i class="fas fa-hand-holding-usd"></i> å–æ¬¾</button>
                <button id="transferBtn" class="btn"><i class="fas fa-exchange-alt"></i> è½¬è´¦</button>
            </div>

            <!-- å­˜æ¬¾ç•Œé¢ -->
            <div id="depositForm" class="verification-step">
                <div class="form-group">
                    <label for="depositAccount">å­˜æ¬¾è´¦å·</label>
                    <input type="text" id="depositAccount" class="form-control" placeholder="è¯·è¾“å…¥å­˜æ¬¾è´¦å·">
                </div>

                <div class="form-group">
                    <label for="depositPassword">è´¦æˆ·å¯†ç </label>
                    <input type="password" id="depositPassword" class="form-control" placeholder="è¯·è¾“å…¥è´¦æˆ·å¯†ç ">
                </div>

                <button id="verifyDepositBtn" class="btn btn-success">éªŒè¯è´¦æˆ·</button>

                <div class="form-group hidden" id="depositAmountGroup">
                    <label for="depositAmount">å­˜æ¬¾é‡‘é¢ï¼ˆå…ƒï¼‰</label>
                    <input type="number" id="depositAmount" class="form-control" placeholder="è¯·è¾“å…¥å­˜æ¬¾é‡‘é¢">
                    <button id="submitDepositBtn" class="btn btn-success" style="margin-top: 15px;">ç¡®è®¤å­˜æ¬¾</button>
                </div>
            </div>

            <!-- å–æ¬¾ç•Œé¢ -->
            <div id="withdrawForm" class="verification-step hidden">
                <div class="form-group">
                    <label for="withdrawAccount">å–æ¬¾è´¦å·</label>
                    <input type="text" id="withdrawAccount" class="form-control" placeholder="è¯·è¾“å…¥å–æ¬¾è´¦å·">
                </div>

                <div class="form-group">
                    <label for="withdrawPassword">è´¦æˆ·å¯†ç </label>
                    <input type="password" id="withdrawPassword" class="form-control" placeholder="è¯·è¾“å…¥è´¦æˆ·å¯†ç ">
                </div>

                <button id="verifyWithdrawBtn" class="btn btn-success">éªŒè¯è´¦æˆ·</button>

                <div class="form-group hidden" id="withdrawAmountGroup">
                    <label for="withdrawAmount">å–æ¬¾é‡‘é¢ï¼ˆå…ƒï¼‰</label>
                    <input type="number" id="withdrawAmount" class="form-control" placeholder="è¯·è¾“å…¥å–æ¬¾é‡‘é¢">
                    <button id="submitWithdrawBtn" class="btn btn-success" style="margin-top: 15px;">ç¡®è®¤å–æ¬¾</button>
                </div>
            </div>

            <!-- è½¬è´¦ç•Œé¢ -->
            <div id="transferForm" class="verification-step hidden">
                <div class="form-group">
                    <label for="fromAccount">è½¬å‡ºè´¦å·</label>
                    <input type="text" id="fromAccount" class="form-control" placeholder="è¯·è¾“å…¥è½¬å‡ºè´¦å·">
                </div>

                <div class="form-group">
                    <label for="toAccount">è½¬å…¥è´¦å·</label>
                    <input type="text" id="toAccount" class="form-control" placeholder="è¯·è¾“å…¥è½¬å…¥è´¦å·">
                </div>

                <div class="form-group">
                    <label for="transferPassword">è½¬å‡ºè´¦æˆ·å¯†ç </label>
                    <input type="password" id="transferPassword" class="form-control" placeholder="è¯·è¾“å…¥è½¬å‡ºè´¦æˆ·å¯†ç ">
                </div>

                <div class="form-group">
                    <label for="transferAmount">è½¬è´¦é‡‘é¢ï¼ˆå…ƒï¼‰</label>
                    <input type="number" id="transferAmount" class="form-control" placeholder="è¯·è¾“å…¥è½¬è´¦é‡‘é¢">
                </div>

                <button id="submitTransferBtn" class="btn btn-success">ç¡®è®¤è½¬è´¦</button>
            </div>

            <div class="result-box hidden" id="transactionResult">
                <h4>æ“ä½œç»“æœ</h4>
                <div id="transactionResultContent"></div>
            </div>
        </div>
    </div>

    <!-- é£æ§å¤„ç†é¡µé¢ -->
    <div id="risk" class="page">
        <div class="card">
            <h2><i class="fas fa-shield-alt"></i>é£æ§å¤„ç†</h2>
            <p>æŸ¥çœ‹é“¶è¡Œç³»ç»Ÿé£é™©æ§åˆ¶æ•°æ®å’Œè­¦æŠ¥ä¿¡æ¯ã€‚</p>

            <button id="showRiskDataBtn" class="btn btn-block">æ˜¾ç¤ºé£æ§æ•°æ®</button>

            <div class="table-container hidden" id="riskTableContainer">
                <table id="riskTable">
                    <thead>
                    <tr>
                        <th>é£é™©ID</th>
                        <th>è´¦æˆ·å·</th>
                        <th>é£é™©ç±»å‹</th>
                        <th>é£é™©ç­‰çº§</th>
                        <th>å‘ç”Ÿæ—¶é—´</th>
                        <th>çŠ¶æ€</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- é£æ§æ•°æ®å°†ç”±JavaScriptåŠ¨æ€å¡«å…… -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ä¸ªäººä¸­å¿ƒé¡µé¢ -->
    <div id="personal" class="page">
        <div class="card">
            <h2><i class="fas fa-user-circle"></i>ä¸ªäººä¸­å¿ƒ</h2>

            <!-- ç¬¬ä¸€æ­¥ï¼šéªŒè¯æ—§å¯†ç  -->
            <div id="verifyOldPasswordStep" class="verification-step active">
                <div class="form-group">
                    <label for="forgotPhone">æ‰‹æœºå·ç </label>
                    <input type="tel" id="forgotPhone" class="form-control" placeholder="è¯·è¾“å…¥æ‚¨çš„æ‰‹æœºå·ç ">
                </div>

                <div class="form-group">
                    <label for="oldPassword">æ—§å¯†ç </label>
                    <input type="password" id="oldPassword" class="form-control" placeholder="è¯·è¾“å…¥æ—§å¯†ç ">
                </div>

                <button id="verifyOldPasswordBtn" class="btn btn-block">éªŒè¯æ—§å¯†ç </button>
            </div>

            <!-- ç¬¬äºŒæ­¥ï¼šè®¾ç½®æ–°å¯†ç ï¼ˆé»˜è®¤éšè—ï¼‰ -->
            <div id="setNewPasswordStep" class="verification-step" style="display: none;">
                <div class="alert alert-success" style="margin-bottom: 20px;">
                    <i class="fas fa-check-circle"></i> æ—§å¯†ç éªŒè¯æˆåŠŸï¼ç°åœ¨å¯ä»¥è®¾ç½®æ–°å¯†ç ã€‚
                </div>

                <div class="form-group">
                    <label for="newPassword">æ–°å¯†ç </label>
                    <input type="password" id="newPassword" class="form-control" placeholder="è¯·è¾“å…¥æ–°å¯†ç ">
                </div>

                <div class="form-group">
                    <label for="confirmNewPassword">ç¡®è®¤æ–°å¯†ç </label>
                    <input type="password" id="confirmNewPassword" class="form-control" placeholder="è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç ">
                </div>

                <button id="submitNewPasswordBtn" class="btn btn-block btn-success">ç¡®è®¤é‡ç½®å¯†ç </button>

                <button id="backToVerifyBtn" class="btn btn-block btn-secondary" style="margin-top: 10px;">
                    <i class="fas fa-arrow-left"></i> è¿”å›é‡æ–°éªŒè¯
                </button>
            </div>

            <!-- æ˜¾ç¤ºç»“æœ -->
            <div class="result-box hidden" id="forgotPasswordResult">
                <h4>é‡ç½®ç»“æœ</h4>
                <div id="forgotPasswordResultContent"></div>
            </div>

            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee;">
                <button id="logoutBtn" class="btn btn-block btn-danger"><i class="fas fa-sign-out-alt"></i> é€€å‡ºç™»å½•</button>
            </div>
        </div>
    </div>


    <footer>
        <p>æ•°å­—é“¶è¡Œç³»ç»Ÿ &copy; 2023 | å®‰å…¨å¯é çš„é“¶è¡ŒæœåŠ¡ | æŠ€æœ¯æ”¯æŒçƒ­çº¿: 400-123-4567</p>
    </footer>
</div>

<script>
    // é¡µé¢å¯¼èˆª
    document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const pageId = this.getAttribute('data-page');

            // æ›´æ–°å¯¼èˆªæ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.nav-link').forEach(nav => nav.classList.remove('active'));
            this.classList.add('active');

            // æ˜¾ç¤ºå¯¹åº”é¡µé¢
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
        });
    });

    // é€‰æ‹©è´¦æˆ·ç±»å‹
    document.querySelectorAll('#register .select-option[data-value]').forEach(option => {
        option.addEventListener('click', function() {
            const parent = this.parentElement;
            const inputId = parent.nextElementSibling.id;

            // ç§»é™¤åŒä¸€ç»„ä¸­å…¶ä»–é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
            parent.querySelectorAll('.select-option').forEach(opt => {
                opt.classList.remove('selected');
            });

            // è®¾ç½®å½“å‰é€‰é¡¹ä¸ºé€‰ä¸­çŠ¶æ€
            this.classList.add('selected');

            // æ›´æ–°éšè—è¾“å…¥æ¡†çš„å€¼
            document.getElementById(inputId).value = this.getAttribute('data-value');
        });
    });

    // =============== åç«¯APIæ¥å£å‡½æ•° ===============
    const api = {
        // 1. æ˜¾ç¤ºåç«¯è¿”å›ç»“æœçš„å‡½æ•°
        showBackendResult(isSuccess, message, data = null) {
            const icon = isSuccess ? 'âœ…' : 'âŒ';
            console.log(`${icon} ${message}`);
            if (data) console.log('ğŸ“Š æ•°æ®:', data);

            // ç®€å•æç¤º
            alert(`${icon} ${message}`);
        },

        // 2. æ³¨å†Œè´¦æˆ· - åªå‘é€è¯·æ±‚
        async registerAccount() {
            const phone = document.getElementById('phone').value;
            const accountType = document.getElementById('accountType').value;
            const branchType = document.getElementById('branchType').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            try {
                const response = await fetch('http://localhost:8080/api/register-account', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        phone,
                        accountType,
                        branchType,
                        password,
                        confirmPassword
                    })
                });

                const result = await response.json();
                this.showBackendResult(result.success, result.message, result.data);

                // æ˜¾ç¤ºæ³¨å†Œç»“æœ
                const resultBox = document.getElementById('registerResult');
                const resultContent = document.getElementById('registerResultContent');

                if (result.success) {
                    resultContent.innerHTML = `
                    <p>${result.message}</p>
                    ${result.data ? `
                    <p><strong>æ³¨å†Œè¯¦æƒ…ï¼š</strong></p>
                    <ul>
                        <li>æ‰‹æœºå·ç ï¼š${phone}</li>
                        <li>è´¦æˆ·ç±»å‹ï¼š${accountType === 'personal' ? 'ä¸ªäººè´¦æˆ·' : 'ä¼ä¸šè´¦æˆ·'}</li>
                        <li>åˆ†è¡Œç±»å‹ï¼š${getBranchName(branchType)}</li>
                        <li>è´¦æˆ·å·ç ï¼š${result.data.accountNumber || ''}</li>
                        <li>è´¦æˆ·ä½™é¢ï¼šÂ¥${result.data.balance ? result.data.balance : '0.00'}</li>
                    </ul>
                    ` : ''}
                `;

                    // æ¸…ç©ºè¡¨å•
                    document.getElementById('phone').value = '';
                    document.getElementById('password').value = '';
                    document.getElementById('confirmPassword').value = '';
                } else {
                    resultContent.innerHTML = `<p>${result.message || 'æ³¨å†Œå¤±è´¥'}</p>`;
                }

                resultBox.classList.remove('hidden');

            } catch (error) {
                this.showBackendResult(false, `ç½‘ç»œé”™è¯¯: ${error.message}`);
            }
        },

        // 3. æŸ¥è¯¢è´¦æˆ· - åªå‘é€è¯·æ±‚
        async searchAccountByPhone() {
            const phone = document.getElementById('searchPhone').value;

            try {
                const response = await fetch(`http://localhost:8080/api/search-account?phone=${phone}`, {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });

                const result = await response.json();
                this.showBackendResult(result.success, result.message, result.data);

                // æ˜¾ç¤ºæŸ¥è¯¢ç»“æœ
                const resultBox = document.getElementById('searchResult');
                const resultContent = document.getElementById('searchResultContent');

                if (result.success && result.data && result.data.accounts) {
                    let html = `<p>${result.message || 'æŸ¥è¯¢æˆåŠŸ'}</p>`;
                    if (result.data.accounts.length > 0) {
                        html += `<p>æ‰¾åˆ° ${result.data.accounts.length} ä¸ªå…³è”è´¦æˆ·ï¼š</p>`;
                        html += '<ul>';
                        result.data.accounts.forEach(account => {
                            html += `
                            <li>
                                <strong>è´¦æˆ·å·ç ï¼š</strong>${account.accountNumber || ''}<br>
                                <strong>è´¦æˆ·ç±»å‹ï¼š</strong>${account.accountType || ''}<br>
                                <strong>å¼€æˆ·åˆ†è¡Œï¼š</strong>${account.branch || ''}<br>
                                <strong>è´¦æˆ·ä½™é¢ï¼š</strong>Â¥${account.balance ? account.balance.toFixed(2) : '0.00'}
                            </li>
                        `;
                        });
                        html += '</ul>';
                    } else {
                        html += '<p>æœªæ‰¾åˆ°ä¸è¯¥æ‰‹æœºå·å…³è”çš„è´¦æˆ·ã€‚</p>';
                    }
                    resultContent.innerHTML = html;
                } else {
                    resultContent.innerHTML = `<p>${result.message || 'æŸ¥è¯¢å¤±è´¥'}</p>`;
                }

                resultBox.classList.remove('hidden');

            } catch (error) {
                this.showBackendResult(false, `ç½‘ç»œé”™è¯¯: ${error.message}`);
            }
        },

        // 4. éªŒè¯è´¦æˆ· - åªå‘é€è¯·æ±‚
        async verifyAccount(account, password) {
            try {
                const response = await fetch('http://localhost:8080/api/verify-account', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ account, password })
                });

                const result = await response.json();
                this.showBackendResult(result.success, result.message, result.data);

                return result;

            } catch (error) {
                this.showBackendResult(false, `ç½‘ç»œé”™è¯¯: ${error.message}`);
                return { success: false, message: 'ç½‘ç»œé”™è¯¯' };
            }
        },

        // 5. å­˜æ¬¾ - åªå‘é€è¯·æ±‚
        async deposit(account, amount) {
            try {
                const response = await fetch('http://localhost:8080/api/deposit', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        account,
                        amount: parseFloat(amount)
                    })
                });

                const result = await response.json();
                this.showBackendResult(result.success, result.message, result.data);

                return result;

            } catch (error) {
                this.showBackendResult(false, `ç½‘ç»œé”™è¯¯: ${error.message}`);
                return { success: false, message: 'ç½‘ç»œé”™è¯¯' };
            }
        },

        // 6. å–æ¬¾ - åªå‘é€è¯·æ±‚
        async withdraw(account, amount) {
            try {
                const response = await fetch('http://localhost:8080/api/withdraw', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        account,
                        amount: parseFloat(amount)
                    })
                });

                const result = await response.json();
                this.showBackendResult(result.success, result.message, result.data);

                return result;

            } catch (error) {
                this.showBackendResult(false, `ç½‘ç»œé”™è¯¯: ${error.message}`);
                return { success: false, message: 'ç½‘ç»œé”™è¯¯' };
            }
        },

        // 7. è½¬è´¦ - åªå‘é€è¯·æ±‚
        async transfer(fromAccount, toAccount, password, amount) {
            try {
                const response = await fetch('http://localhost:8080/api/transfer', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        fromAccount,
                        toAccount,
                        password,
                        amount: parseFloat(amount)
                    })
                });

                const result = await response.json();
                this.showBackendResult(result.success, result.message, result.data);

                return result;

            } catch (error) {
                this.showBackendResult(false, `ç½‘ç»œé”™è¯¯: ${error.message}`);
                return { success: false, message: 'ç½‘ç»œé”™è¯¯' };
            }
        },

        // 8. è·å–é£æ§æ•°æ® - åªå‘é€è¯·æ±‚
        async getRiskData() {
            try {
                const response = await fetch('http://localhost:8080/api/risk-data', {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });

                const result = await response.json();
                this.showBackendResult(result.success, result.message, result.data);

                return result;

            } catch (error) {
                this.showBackendResult(false, `ç½‘ç»œé”™è¯¯: ${error.message}`);
                return { success: false, message: 'ç½‘ç»œé”™è¯¯' };
            }
        },

        async verifyOldPassword() {
            const phone = document.getElementById('forgotPhone').value;
            const oldPassword = document.getElementById('oldPassword').value;

            try {
                const response = await fetch('http://localhost:8080/api/verify-old-password', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        phone,
                        oldPassword
                    })
                });

                const result = await response.json();

                // æ˜¾ç¤ºåç«¯è¿”å›çš„ç»“æœ
                if (result.success) {
                    this.showBackendResult(true, result.message || "æ—§å¯†ç éªŒè¯æˆåŠŸ");
                    // ä¿å­˜éªŒè¯æˆåŠŸçš„æ‰‹æœºå·
                    document.getElementById('verifyOldPasswordStep').classList.add('hidden');
                    document.getElementById('setNewPasswordStep').classList.remove('hidden');
                    document.getElementById('setNewPasswordStep').style.display = 'block';
                    document.getElementById('forgotPasswordResult').classList.add('hidden');
                } else {
                    this.showBackendResult(false, result.message || "æ—§å¯†ç éªŒè¯å¤±è´¥");
                }

                return result;

            } catch (error) {
                this.showBackendResult(false, `ç½‘ç»œé”™è¯¯: ${error.message}`);
                return { success: false, message: 'ç½‘ç»œé”™è¯¯' };
            }
        },

        // 10. é‡ç½®å¯†ç  - åªå‘é€è¯·æ±‚ï¼Œåç«¯éªŒè¯
        async resetPassword() {
            const phone = document.getElementById('forgotPhone').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmNewPassword').value;

            try {
                const response = await fetch('http://localhost:8080/api/reset-password', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        phone,
                        newPassword,
                        confirmPassword
                    })
                });

                const result = await response.json();
                this.showBackendResult(result.success, result.message, result.data);

                // æ˜¾ç¤ºé‡ç½®ç»“æœ
                const resultBox = document.getElementById('forgotPasswordResult');
                const resultContent = document.getElementById('forgotPasswordResultContent');

                if (result.success) {
                    resultContent.innerHTML = `
                    <p>${result.message}</p>
                    ${result.data ? `
                    <p><strong>é‡ç½®è¯¦æƒ…ï¼š</strong></p>
                    <ul>
                        <li>æ‰‹æœºå·ç ï¼š${phone}</li>
                        <li>é‡ç½®æ—¶é—´ï¼š${new Date().toLocaleString()}</li>
                        <li>é‡ç½®è´¦æˆ·æ•°ï¼š${result.data.resetCount || 1}</li>
                        <li>çŠ¶æ€ï¼šæˆåŠŸ</li>
                    </ul>
                    ` : ''}
                `;

                    // æ¸…ç©ºè¡¨å•å¹¶è¿”å›ç¬¬ä¸€æ­¥
                    resetPasswordForm();
                } else {
                    resultContent.innerHTML = `<p>${result.message || 'é‡ç½®å¯†ç å¤±è´¥'}</p>`;
                }

                resultBox.classList.remove('hidden');

                return result;

            } catch (error) {
                this.showBackendResult(false, `ç½‘ç»œé”™è¯¯: ${error.message}`);
                return { success: false, message: 'ç½‘ç»œé”™è¯¯' };
            }
        },


        // 11. é€€å‡ºç™»å½• - åªå‘é€è¯·æ±‚
        async logout() {
            try {
                const response = await fetch('http://localhost:8080/api/logout', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const result = await response.json();
                this.showBackendResult(result.success, result.message, result.data);

                if (result.success) {
                    // å»¶è¿Ÿ1ç§’åè·³è½¬ï¼Œè®©ç”¨æˆ·çœ‹åˆ°æˆåŠŸæ¶ˆæ¯
                    setTimeout(() => {
                        // è·³è½¬åˆ°ç™»å½•é¡µ
                        window.location.href = 'index.html';
                    }, 1000);
                }

            } catch (error) {
                this.showBackendResult(false, `ç½‘ç»œé”™è¯¯: ${error.message}`);
            }
        }
    };

    // =============== æŒ‰é’®äº‹ä»¶ç»‘å®š ===============

    // 1. æ³¨å†Œè´¦æˆ·æŒ‰é’®
    document.getElementById('registerBtn').addEventListener('click', async function() {
        await api.registerAccount();
    });

    // 2. æŸ¥è¯¢è´¦æˆ·æŒ‰é’®
    document.getElementById('searchAccountBtn').addEventListener('click', async function() {
        await api.searchAccountByPhone();
    });

    // 3. ä¸šåŠ¡å¤„ç†æŒ‰é’®åˆ‡æ¢
    document.getElementById('depositBtn').addEventListener('click', function() {
        resetTransactionForms();
        document.getElementById('depositForm').classList.add('active');
        document.getElementById('transactionResult').classList.add('hidden');
    });

    document.getElementById('withdrawBtn').addEventListener('click', function() {
        resetTransactionForms();
        document.getElementById('withdrawForm').classList.add('active');
        document.getElementById('transactionResult').classList.add('hidden');
    });

    document.getElementById('transferBtn').addEventListener('click', function() {
        resetTransactionForms();
        document.getElementById('transferForm').classList.add('active');
        document.getElementById('transactionResult').classList.add('hidden');
    });

    // 4. å­˜æ¬¾éªŒè¯æŒ‰é’®
    document.getElementById('verifyDepositBtn').addEventListener('click', async function() {
        const account = document.getElementById('depositAccount').value;
        const password = document.getElementById('depositPassword').value;

        const result = await api.verifyAccount(account, password);

        if (result && result.success) {
            showAlert('éªŒè¯æˆåŠŸï¼ç°åœ¨å¯ä»¥è¾“å…¥å­˜æ¬¾é‡‘é¢ã€‚', 'success');
            document.getElementById('depositAmountGroup').classList.remove('hidden');
        }
    });

    // 5. å­˜æ¬¾æäº¤æŒ‰é’®
    document.getElementById('submitDepositBtn').addEventListener('click', async function() {
        const account = document.getElementById('depositAccount').value;
        const amount = document.getElementById('depositAmount').value;

        const result = await api.deposit(account, amount);
        showTransactionResult(result);
    });

    // 6. å–æ¬¾éªŒè¯æŒ‰é’®
    document.getElementById('verifyWithdrawBtn').addEventListener('click', async function() {
        const account = document.getElementById('withdrawAccount').value;
        const password = document.getElementById('withdrawPassword').value;

        const result = await api.verifyAccount(account, password);

        if (result && result.success) {
            showAlert('éªŒè¯æˆåŠŸï¼ç°åœ¨å¯ä»¥è¾“å…¥å–æ¬¾é‡‘é¢ã€‚', 'success');
            document.getElementById('withdrawAmountGroup').classList.remove('hidden');
        }
    });

    // 7. å–æ¬¾æäº¤æŒ‰é’®
    document.getElementById('submitWithdrawBtn').addEventListener('click', async function() {
        const account = document.getElementById('withdrawAccount').value;
        const amount = document.getElementById('withdrawAmount').value;

        const result = await api.withdraw(account, amount);
        showTransactionResult(result);
    });

    // 8. è½¬è´¦æäº¤æŒ‰é’®
    document.getElementById('submitTransferBtn').addEventListener('click', async function() {
        const fromAccount = document.getElementById('fromAccount').value;
        const toAccount = document.getElementById('toAccount').value;
        const password = document.getElementById('transferPassword').value;
        const amount = document.getElementById('transferAmount').value;

        const result = await api.transfer(fromAccount, toAccount, password, amount);
        showTransactionResult(result);
    });

    // 9. æ˜¾ç¤ºé£æ§æ•°æ®æŒ‰é’®
    document.getElementById('showRiskDataBtn').addEventListener('click', async function() {
        const result = await api.getRiskData();

        if (result && result.success && result.data) {
            const tableBody = document.querySelector('#riskTable tbody');
            tableBody.innerHTML = '';

            if (result.data.riskRecords && result.data.riskRecords.length > 0) {
                result.data.riskRecords.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.id || ''}</td>
                        <td>${item.account || ''}</td>
                        <td>${item.riskType || ''}</td>
                        <td><span class="risk-level risk-${item.riskLevel || ''}">${item.riskLevel || ''}</span></td>
                        <td>${item.time ? new Date(item.time).toLocaleString() : ''}</td>
                        <td>${item.status || ''}</td>
                    `;
                    tableBody.appendChild(row);
                });

                // æ·»åŠ CSSæ ·å¼
                const style = document.createElement('style');
                style.textContent = `
                    .risk-é«˜ { background-color: #f8d7da; color: #721c24; padding: 5px 10px; border-radius: 4px; }
                    .risk-ä¸­ { background-color: #fff3cd; color: #856404; padding: 5px 10px; border-radius: 4px; }
                    .risk-ä½ { background-color: #d1ecf1; color: #0c5460; padding: 5px 10px; border-radius: 4px; }
                `;
                document.head.appendChild(style);

                document.getElementById('riskTableContainer').classList.remove('hidden');
            } else {
                showAlert('æš‚æ— é£æ§æ•°æ®', 'info');
            }
        }
    });
    //10.
    // éªŒè¯æ—§å¯†ç æŒ‰é’®
    document.getElementById('verifyOldPasswordBtn').addEventListener('click', async function() {
        await api.verifyOldPassword();
    });

    // æäº¤æ–°å¯†ç æŒ‰é’®
    document.getElementById('submitNewPasswordBtn').addEventListener('click', async function() {
        await api.resetPassword();
    });

    // è¿”å›é‡æ–°éªŒè¯æŒ‰é’®
    document.getElementById('backToVerifyBtn').addEventListener('click', function() {
        // è¿”å›ç¬¬ä¸€æ­¥
        document.getElementById('setNewPasswordStep').classList.add('hidden');
        document.getElementById('setNewPasswordStep').style.display = 'none';
        document.getElementById('verifyOldPasswordStep').classList.remove('hidden');
        document.getElementById('forgotPasswordResult').classList.add('hidden');
    });

    // 11. é€€å‡ºç™»å½•æŒ‰é’®
    document.getElementById('logoutBtn').addEventListener('click', async function() {
        if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
            await api.logout();
        }
    });

    // =============== å·¥å…·å‡½æ•° ===============

    function resetTransactionForms() {
        document.querySelectorAll('.verification-step').forEach(form => {
            form.classList.remove('active');
            form.classList.add('hidden');
        });

        document.getElementById('depositAmountGroup').classList.add('hidden');
        document.getElementById('withdrawAmountGroup').classList.add('hidden');
    }

    function showTransactionResult(result) {
        const resultBox = document.getElementById('transactionResult');
        const resultContent = document.getElementById('transactionResultContent');

        if (result && result.success) {
            resultContent.innerHTML = `
                <p>${result.message || 'æ“ä½œæˆåŠŸ'}</p>
                ${result.data && result.data.transaction ? `
                <p><strong>äº¤æ˜“è¯¦æƒ…ï¼š</strong></p>
                <ul>
                    <li>äº¤æ˜“æ—¶é—´ï¼š${new Date().toLocaleString()}</li>
                    <li>äº¤æ˜“çŠ¶æ€ï¼šæˆåŠŸ</li>
                    <li>è´¦æˆ·ä½™é¢ï¼šÂ¥${result.data.transaction.newBalance ? result.data.transaction.newBalance.toFixed(2) : 'æœªçŸ¥'}</li>
                    <li>äº¤æ˜“æµæ°´å·ï¼š${result.data.transaction.transactionId || 'TR' + Date.now()}</li>
                </ul>
                ` : ''}
            `;

            // æ¸…ç©ºè¡¨å•
            resetTransactionForms();
            document.querySelectorAll('.verification-step .form-control').forEach(input => {
                input.value = '';
            });
        } else {
            resultContent.innerHTML = `<p>${result.message || 'æ“ä½œå¤±è´¥'}</p>`;
        }

        resultBox.classList.remove('hidden');
    }

    function getBranchName(branchCode) {
        const branches = {
            'beijing': 'åŒ—äº¬åˆ†è¡Œ',
            'shanghai': 'ä¸Šæµ·åˆ†è¡Œ',
            'guangzhou': 'å¹¿å·åˆ†è¡Œ',
            'shenzhen': 'æ·±åœ³åˆ†è¡Œ'
        };
        return branches[branchCode] || 'æœªçŸ¥åˆ†è¡Œ';
    }

    function showAlert(message, type) {
        // ç§»é™¤ç°æœ‰çš„æç¤º
        const existingAlert = document.querySelector('.alert');
        if (existingAlert) existingAlert.remove();

        // åˆ›å»ºæ–°çš„æç¤º
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type}`;
        alertDiv.textContent = message;

        // æ’å…¥åˆ°é¡µé¢é¡¶éƒ¨
        document.querySelector('.container').insertBefore(alertDiv, document.querySelector('header'));

        // 5ç§’åè‡ªåŠ¨ç§»é™¤
        setTimeout(() => {
            if (alertDiv.parentNode) {
                alertDiv.remove();
            }
        }, 5000);
    }

    // é¡µé¢åŠ è½½æ—¶é»˜è®¤æ˜¾ç¤ºå­˜æ¬¾ç•Œé¢
    document.getElementById('depositForm').classList.add('active');
</script>
</body>
</html>